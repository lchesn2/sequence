<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admins Only</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}">
</head>
<body>
    <div class="main-container">
        <div class="header">
            <div class="header-top">
                <div class="welcome-message">
                    <i class="fas fa-user-circle"></i> {{ name }}
                </div>
                <div class="nav-buttons">
                    <a href="{{ url_for('halloffame') }}" class="nav-btn">
                        <i class="fas fa-chess-queen"></i> Hall of Fame
                    </a>
                    <a href="{{ url_for('hallofshame') }}" class="nav-btn">
                        <i class="fas fa-chess-pawn"></i> Hall of Shame
                    </a>
                    <a href="{{ url_for('logout') }}" class="nav-btn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </div>
            <h1><i class="fas fa-chess-board"></i> Admin Dashboard</h1>
            <p class="subtitle">Welcome {{name}}, thank you for your steadfast contribution to entering sequence data</p>
        </div>

        <div class="content">
            <!-- Last Player -->
            <div class="last-finish">
                <h3><i class="fas fa-chess"></i> Last Finisher: {{ nxtTurn }}</h3>
            </div>

            <!-- Add New Entry -->
            <div class="form-section">
                <div class="section-header">
                    <i class="fas fa-plus-circle"></i>
                    <h2>Add New Entry</h2>
                </div>
                <form action="submit_form" method="post">
                    <div class="form-group">
                        <label for="date"><i class="fas fa-calendar"></i> Date</label>
                        <input type="text" id="date" name="date" readonly>
                    </div>

                    <div class="form-group">
                        <label for="time"><i class="fas fa-clock"></i> Time</label>
                        <input type="text" id="time" name="time" readonly>
                    </div>

                    <div class="form-group">
                        <label for="name"><i class="fas fa-user"></i> Player Name</label>
                        <select name="name" id="name" required>
                            <option value="">Select Player</option>
                            <option value="Adam">Adam</option>
                            <option value="Behring">Behring</option>
                            <option value="Choi">Choi</option>
                            <option value="Daniel">Daniel</option>
                            <option value="Edward">Edward</option>
                            <option value="Howard">Howard</option>
                            <option value="Jaemo">Jaemo</option>
                            <option value="John">John</option>
                            <option value="Jose">Jose</option>
                            <option value="Kenji">Kenji</option>
                            <option value="Larah">Larah</option>
                            <option value="Maya">Maya</option>
                            <option value="Mel">Mel</option>
                            <option value="Nishant">Nishant</option>
                            <option value="Pratishta">Pratishta</option>
                            <option value="Russell">Russell</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="type"><i class="fas fa-tag"></i> Action Type</label>
                        <select name="type" id="type" required>
                            <option value="">Select Type</option>
                            <option value="Assist">Assist</option>
                            <option value="Block">Block</option>
                            <option value="Sequence">Sequence</option>
                        </select>
                    </div>

                    <button type="submit" class="submit-btn">
                        <i class="fas fa-save"></i> Submit Entry
                    </button>
                </form>
            </div>

            <!-- Play by Play -->
            <div class="form-section">
                <div class="section-header">
                    <i class="fas fa-list-alt"></i>
                    <h2>Play by Play</h2>
                </div>
                <div class="table-container">
                    <table class="table" id="lancelot">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Player</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tbody id="lancelot_data">
                            {% for row in data %}
                            <tr data-date="{{ row[0] }}" data-time="{{ row[1] }}" data-name="{{ row[2] }}" data-type="{{ row[3] }}">
                                <td>{{ row[0] }}</td>
                                <td><strong>{{ row[2] }}</strong></td>
                                <td>
                                    <span class="type-badge type-{{ row[3].lower() }}">
                                        {% if row[3] == 'Sequence' %}
                                            <i class="fas fa-crown"></i>
                                        {% elif row[3] == 'Assist' %}
                                            <i class="fas fa-handshake"></i>
                                        {% elif row[3] == 'Block' %}
                                            <i class="fas fa-shield-alt"></i>
                                        {% endif %}
                                        {{ row[3] }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"></script>

    <script>
        function getCurrentTime() {
            const now = new Date();
            const hours   = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        }

        function getCurrentDate() {
            const now = new Date();
            const year  = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day   = String(now.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        document.getElementById('date').value = getCurrentDate();
        document.getElementById('time').value = getCurrentTime();

        setInterval(() => {
            document.getElementById('time').value = getCurrentTime();
        }, 1000);

        $(document).ready(function() {
            $('#lancelot').DataTable({
                responsive: true,
                pageLength: 15,
                order: [[0, 'desc']],
                language: {
                    search: "Search entries:",
                    lengthMenu: "Show _MENU_ entries",
                    info: "Showing _START_ to _END_ of _TOTAL_ entries",
                    paginate: {
                        first: "First",
                        last: "Last",
                        next: "Next",
                        previous: "Previous"
                    }
                }
            });

            // Row click â€” use data attributes so indices don't matter
            $('#lancelot tbody').on('click', 'tr', function() {
                $(this).toggleClass('selected');

                axios.post('/send-data', {
                    date: $(this).data('date'),
                    time: $(this).data('time'),
                    name: $(this).data('name'),
                    type: $(this).data('type')
                })
                .then(function(response) {
                    console.log('Data sent successfully:', response.data);
                })
                .catch(function(error) {
                    console.error('Error sending data:', error);
                });
            });

            $('form').on('submit', function() {
                var submitBtn = $(this).find('.submit-btn');
                submitBtn.html('<i class="fas fa-spinner fa-spin"></i> Submitting...');
                submitBtn.prop('disabled', true);

                setTimeout(() => {
                    submitBtn.html('<i class="fas fa-save"></i> Submit Entry');
                    submitBtn.prop('disabled', false);
                }, 2000);
            });
        });
    </script>
</body>
</html>